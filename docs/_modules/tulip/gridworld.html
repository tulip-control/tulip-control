<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tulip.gridworld &#8212; TuLiP 1.4.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=ff85e404" />
    <link rel="stylesheet" type="text/css" href="../../_static/patch.css?v=0ad0caba" />
    
    <script src="../../_static/documentation_options.js?v=350a9c04"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <script src="../../_static/sidebar.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TuLiP 1.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">tulip.gridworld</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for tulip.gridworld</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2012-2016 by California Institute of Technology</span>
<span class="c1"># All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions</span>
<span class="c1"># are met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright</span>
<span class="c1">#    notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#    notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#    documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># 3. Neither the name of the California Institute of Technology nor</span>
<span class="c1">#    the names of its contributors may be used to endorse or promote</span>
<span class="c1">#    products derived from this software without specific prior</span>
<span class="c1">#    written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS</span>
<span class="c1"># FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL CALTECH</span>
<span class="c1"># OR THE CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c1"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c1"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
<span class="c1"># USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<span class="c1"># ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="c1"># OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
<span class="c1"># OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="c1"># SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;Routines for working with gridworlds.</span>

<span class="sd">Note (24 June 2012): Several pieces of source code are taken or</span>
<span class="sd">derived from btsynth; see &lt;http://scottman.net/2012/btsynth&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">_itr</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">_ty</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">_mpl</span>
    <span class="kn">import</span> <span class="nn">matplotlib.animation</span>
    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">mpl_cm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.patches</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_mpl</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">import</span> <span class="nn">tulip.abstract</span> <span class="k">as</span> <span class="nn">_abs</span>
<span class="kn">import</span> <span class="nn">tulip.spec.form</span> <span class="k">as</span> <span class="nn">_form</span>
<span class="kn">import</span> <span class="nn">tulip._utils</span> <span class="k">as</span> <span class="nn">_utl</span>

<span class="c1"># inline:</span>
<span class="c1">#</span>
<span class="c1"># import polytope</span>
<span class="c1"># import tulip.abstract.prop2part</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;GridWorld&#39;</span><span class="p">,</span>
    <span class="s1">&#39;random_world&#39;</span><span class="p">,</span>
    <span class="s1">&#39;narrow_passage&#39;</span><span class="p">,</span>
    <span class="s1">&#39;unoccupied&#39;</span><span class="p">,</span>
    <span class="s1">&#39;add_trolls&#39;</span><span class="p">,</span>
    <span class="s1">&#39;extract_coord&#39;</span><span class="p">,</span>
    <span class="s1">&#39;animate_paths&#39;</span><span class="p">]</span>


<span class="n">IJ</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="n">XY</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="k">if</span> <span class="n">_ty</span><span class="o">.</span><span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="n">FuncAnimation</span> <span class="o">=</span> <span class="n">_mpl</span><span class="o">.</span><span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">FuncAnimation</span> <span class="o">=</span> <span class="n">_utl</span><span class="o">.</span><span class="n">get_type</span><span class="p">(</span>
        <span class="n">_mpl</span><span class="p">,</span> <span class="s1">&#39;animation.FuncAnimation&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GridWorld</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;4-connected grids with primitives.</span>

<span class="sd">    Obstacles and goals are examples of</span>
<span class="sd">    primitives.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">gw_desc</span><span class="p">:</span>
                <span class="nb">str</span> <span class="o">|</span>
                <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">prefix</span><span class="p">:</span>
                <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load gridworld from `gw_desc`.</span>

<span class="sd">        If `gw_desc is None`,</span>
<span class="sd">        make empty instance.</span>

<span class="sd">        @param gw_desc:</span>
<span class="sd">            Gridworld description, or</span>
<span class="sd">            None to create an empty instance.</span>
<span class="sd">        @param prefix:</span>
<span class="sd">            Prefix for naming</span>
<span class="sd">            gridworld cell variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">gw_desc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">gw_desc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">gw</span><span class="o">.</span><span class="n">W</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="n">gw</span><span class="o">.</span><span class="n">init_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="n">gw</span><span class="o">.</span><span class="n">goal_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">other</span><span class="p">:</span>
                <span class="s1">&#39;GridWorld&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test for equality.</span>

<span class="sd">        Does not compare prefixes of cell variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
                <span class="c1"># Only one of</span>
                <span class="c1"># the two is undefined.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">W</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">other</span><span class="p">:</span>
                <span class="s1">&#39;GridWorld&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pretty</span><span class="p">(</span><span class="n">show_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">key</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">,</span>
            <span class="n">use_next</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">nonbool</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return variable name corresponding to this cell.</span>

<span class="sd">        Supports negative wrapping, e.g., if Y is an instance of</span>
<span class="sd">        GridWorld, then Y[-1,-1] will return the variable name of the</span>
<span class="sd">        cell in the bottom-right corner, Y[0,-1] the name of the</span>
<span class="sd">        top-right corner cell, etc.  As usual in Python, you can only</span>
<span class="sd">        wrap around once.</span>

<span class="sd">        @param next:</span>
<span class="sd">            Use the primed (i.e., state at next time step)</span>
<span class="sd">            form of the variable.</span>
<span class="sd">        @param nonbool:</span>
<span class="sd">            If True, then use variables with integer domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; &quot;</span>
                <span class="s2">&quot;no names available.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld key.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;gridworld key is out of bounds.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_next</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;((X (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;_r = </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;)) &amp;&amp; (X (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;_c = </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">)))&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;((</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;_r = </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;) &amp;&amp; (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;_c = </span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">))&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_next</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;X &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GridWorld</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dumps</span><span class="p">(),</span>
            <span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deep-copy GridWorld instance.</span>

<span class="sd">        The copy has no dependence on the original.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">state</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">key</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">,</span>
            <span class="n">offset</span><span class="p">:</span>
                <span class="n">IJ</span>
                <span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">nonbool</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return dictionary form of state with keys of variable names.</span>

<span class="sd">        Supports negative indices for key, e.g., as in __getitem__.</span>

<span class="sd">        The offset argument is motivated by the use-case of multiple</span>
<span class="sd">        agents whose moves are governed by separate &quot;gridworlds&quot; but</span>
<span class="sd">        who interact in a shared space; with an offset, we can make</span>
<span class="sd">        &quot;sub-gridworlds&quot; and enforce rules like mutual exclusion.</span>

<span class="sd">        @param nonbool:</span>
<span class="sd">            If True, then use variables with integer domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; &quot;</span>
                <span class="s2">&quot;no cells exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld key.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;gridworld key is out of bounds.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">output</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">output</span><span class="p">[</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">output</span><span class="p">[</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_&#39;</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">coord</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">,</span>
            <span class="n">extend</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is cell at coord empty?</span>

<span class="sd">        @param coord:</span>
<span class="sd">            (row, column) pair; supports negative indices.</span>
<span class="sd">        @param extend:</span>
<span class="sd">            If True, then do not wrap indices and treat any</span>
<span class="sd">            cell outside the grid as being occupied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; &quot;</span>
                <span class="s2">&quot;no cells exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld coord.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="ow">and</span> <span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
                       <span class="ow">or</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
                       <span class="ow">or</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">mark_occupied</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">coord</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark cell at coord as statically (permanently) occupied.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; no cells exist.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">mark_empty</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">coord</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark cell at coord as empty.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; no cells exist.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">is_reachable</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">start</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">,</span>
            <span class="n">stop</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decide whether there is a path from start cell to stop.</span>

<span class="sd">        Assume the gridworld is 4-connected.</span>

<span class="sd">        @param start:</span>
<span class="sd">            (row, column) pair; supports negative indices.</span>
<span class="sd">        @param stop:</span>
<span class="sd">            same as start argument.</span>
<span class="sd">        @return:</span>
<span class="sd">            True if there is a path, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check input values and</span>
        <span class="c1"># handle negative coordinates</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld is empty; &quot;</span>
                <span class="s2">&quot;no names available.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld start coordinate.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;gridworld start coordinate &quot;</span>
                <span class="s2">&quot;is out of bounds.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld stop coordinate.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;gridworld stop coordinate is out of bounds.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">stop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># Quick sanity check</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">(</span><span class="n">stop</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Similar to depth-first search</span>
        <span class="n">OPEN</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        <span class="n">CLOSED</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">OPEN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">OPEN</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                        <span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                        <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                        <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">((</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="p">))</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">CLOSED</span> <span class="ow">and</span>
                        <span class="p">(</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">OPEN</span><span class="p">):</span>
                    <span class="n">OPEN</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">current</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="p">))</span>
            <span class="n">CLOSED</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">font_pt</span><span class="p">:</span>
                <span class="nb">int</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="n">show_grid</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">grid_width</span><span class="p">:</span>
                <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">troll_list</span><span class="p">:</span>
                <span class="nb">list</span> <span class="o">|</span>
                <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Draw figure depicting this gridworld.</span>

<span class="sd">        Figure legend (symbolic form in parenthesis):</span>
<span class="sd">          - &quot;I&quot; (&#39;m+&#39;) : possible initial position;</span>
<span class="sd">          - &quot;G&quot; (&#39;r*&#39;) : goal;</span>
<span class="sd">          - &quot;E&quot; (&#39;gx&#39;) : goal of a troll; its extent is indicated by gray cells</span>

<span class="sd">        @param font_pt:</span>
<span class="sd">            size (in points) for rendering text in the</span>
<span class="sd">            figure.  If 0, then use symbols instead (see legend above).</span>
<span class="sd">        @param troll_list:</span>
<span class="sd">            ...same as the argument with the same name</span>
<span class="sd">            given to `add_trolls`.</span>
<span class="sd">        @param axes:</span>
<span class="sd">            Instance of matplotlib.axes._subplots.AxesSubplot</span>
<span class="sd">            on which to draw, or None, in which case a new figure</span>
<span class="sd">            is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">troll_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">troll_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">_mpl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s1">&#39;matplotlib not available, &#39;</span>
                <span class="s1">&#39;so skipping GridWorld.plot()&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="n">W</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">mpl_cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                  <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">,</span>
                  <span class="n">vmin</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
        <span class="n">x_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show_grid</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x_steps</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_width</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">y_steps</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_width</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">font_pt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">font_pt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;m+&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">font_pt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">font_pt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">font_pt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;E&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">font_pt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;gx&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                    <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;troll center is outside of gridworld&quot;</span><span class="p">)</span>
            <span class="n">t_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">))</span>
            <span class="n">t_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span>
                      <span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">t_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">j</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                            <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">x_steps</span><span class="p">[</span>
                                    <span class="n">j</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                    <span class="n">y_steps</span><span class="p">[</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">])]),</span>
                                <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">.8</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">pretty</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">show_grid</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">line_prefix</span><span class="p">:</span>
                <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">path</span><span class="p">:</span>
                <span class="nb">list</span> <span class="o">|</span>
                <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">goal_order</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return pretty-for-printing string.</span>

<span class="sd">        @param show_grid:</span>
<span class="sd">            If True, then grid the pretty world and show</span>
<span class="sd">            row and column labels along the outer edges.</span>
<span class="sd">        @param line_prefix:</span>
<span class="sd">            prefix each line with this string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">def</span> <span class="nf">compress</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span>
                    <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p</span><span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="c1"># See comments in code for</span>
        <span class="c1"># the method loads regarding values in W</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># LEGEND:</span>
        <span class="c1">#  * - wall</span>
        <span class="c1">#      (as used in original world</span>
        <span class="c1">#       matrix definition);</span>
        <span class="c1">#  G - goal location;</span>
        <span class="c1">#  I - possible initial location.</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="n">line_prefix</span>
        <span class="k">def</span> <span class="nf">direct</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">):</span>
            <span class="n">y1</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">c1</span>
            <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">c2</span>
            <span class="k">if</span> <span class="n">x1</span> <span class="o">&gt;</span> <span class="n">x2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&lt;&quot;</span>
            <span class="k">elif</span> <span class="n">x1</span> <span class="o">&lt;</span> <span class="n">x2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;&gt;&quot;</span>
            <span class="k">elif</span> <span class="n">y1</span> <span class="o">&gt;</span> <span class="n">y2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;^&quot;</span>
            <span class="k">elif</span> <span class="n">y1</span> <span class="o">&lt;</span> <span class="n">y2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;v&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># c1 == c2</span>
                <span class="k">return</span> <span class="s2">&quot;.&quot;</span>
        <span class="k">if</span> <span class="n">show_grid</span><span class="p">:</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span>
                    <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="c1"># if path:</span>
        <span class="c1">#    path = compress(path)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">line_prefix</span>
            <span class="k">if</span> <span class="n">show_grid</span><span class="p">:</span>
                <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">out_str</span> <span class="o">+=</span> <span class="n">line_prefix</span>
                <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;|&quot;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">show_grid</span><span class="p">:</span>
                    <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;|&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;I&quot;</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">goal_order</span><span class="p">:</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;G&quot;</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                        <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                            <span class="n">path</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                            <span class="n">d</span> <span class="o">=</span> <span class="n">direct</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">path</span><span class="p">[(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)])</span>
                            <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="s2">&quot;.&quot;</span><span class="p">:</span>
                                <span class="k">break</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="n">d</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;*&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Unrecognized internal world W encoding.&quot;</span><span class="p">)</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;|</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">out_str</span> <span class="o">+=</span> <span class="n">line_prefix</span>
        <span class="k">if</span> <span class="n">show_grid</span><span class="p">:</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out_str</span>

    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return size of gridworld as a tuple in row-major order.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span>

<div class="viewcode-block" id="GridWorld.loads">
<a class="viewcode-back" href="../../gridworlds.html#tulip.gridworld.GridWorld.loads">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">loads</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">gw_desc</span><span class="p">:</span>
                <span class="nb">str</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reincarnate using given gridworld description string.</span>

<span class="sd">        @param gw_desc:</span>
<span class="sd">            String containing a gridworld description.</span>

<span class="sd">        In a gridworld description, any line beginning with # is</span>
<span class="sd">        ignored (regarded as a comment). The first non-blank and</span>
<span class="sd">        non-comment line must give the grid size as two positive</span>
<span class="sd">        integers separated by whitespace, with the first being the</span>
<span class="sd">        number of rows and the second the number of columns.</span>

<span class="sd">        Each line after the size line is used to construct a row of</span>
<span class="sd">        the gridworld. These are read in order with maximum number of</span>
<span class="sd">        lines being the number of rows in the gridworld.  A row</span>
<span class="sd">        definition is whitespace-sensitive up to the number of columns</span>
<span class="sd">        (any characters beyond the column count are ignored, so in</span>
<span class="sd">        particular trailing whitespace is allowed) and can include the</span>
<span class="sd">        following symbols:</span>

<span class="sd">          - &#39; &#39; : an empty cell,</span>
<span class="sd">          - &#39;*&#39; : a statically occupied cell,</span>
<span class="sd">          - &#39;I&#39; : possible initial cell,</span>
<span class="sd">          - &#39;G&#39; : goal cell (must be visited infinitely often).</span>

<span class="sd">        If the end of file is reached before all rows have been</span>
<span class="sd">        constructed, then the remaining rows are assumed to be empty.</span>
<span class="sd">        After all rows have been constructed, the remainder of the</span>
<span class="sd">        file is ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">###################################################</span>
        <span class="c1"># Internal format notes:</span>
        <span class="c1">#</span>
        <span class="c1"># W is a matrix of integers with</span>
        <span class="c1"># the same shape as the</span>
        <span class="c1"># gridworld.  Each element has</span>
        <span class="c1"># value indicating properties of</span>
        <span class="c1"># the corresponding cell,</span>
        <span class="c1"># according the following key.</span>
        <span class="c1">#</span>
        <span class="c1"># 0 - empty,</span>
        <span class="c1"># 1 - statically (permanently) occupied.</span>
        <span class="c1">###################################################</span>
        <span class="n">W</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">init_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">goal_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">row_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">gw_desc</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">row_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Size has been read,</span>
                <span class="c1"># so we are processing</span>
                <span class="c1"># row definitions</span>
                <span class="k">if</span> <span class="n">row_index</span> <span class="o">&gt;=</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                        <span class="n">W</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                        <span class="n">W</span><span class="p">[</span><span class="n">row_index</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
                        <span class="n">init_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row_index</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;G&quot;</span><span class="p">:</span>
                        <span class="n">goal_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row_index</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s1">&#39;unrecognized row symbol &quot;&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">line</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
                <span class="n">row_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Still looking for</span>
                <span class="c1"># gridworld size in</span>
                <span class="c1"># the given string</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                        <span class="c1"># Ignore blank and</span>
                        <span class="c1"># comment lines</span>
                <span class="n">line_el</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">line_el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_el</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                <span class="n">row_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;malformed gridworld description.&quot;</span><span class="p">)</span>
        <span class="c1"># Arrived here without errors,</span>
        <span class="c1"># so actually reincarnate</span>
        <span class="n">gw</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">()</span>
        <span class="n">gw</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
        <span class="n">gw</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="n">init_list</span>
        <span class="n">gw</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="n">goal_list</span>
        <span class="k">return</span> <span class="n">gw</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span>
            <span class="bp">cls</span><span class="p">,</span>
            <span class="n">gw_file</span><span class="p">:</span>
                <span class="nb">str</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read description from given file.</span>

<span class="sd">        Merely a convenience wrapper for the `loads` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">gw_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dumps</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">line_prefix</span><span class="p">:</span>
                <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dump gridworld description string.</span>

<span class="sd">        @param line_prefix:</span>
<span class="sd">            prefix each line with this string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld does not exist.&quot;</span><span class="p">)</span>
        <span class="n">out_str</span> <span class="o">=</span> <span class="n">line_prefix</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="n">line_prefix</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;I&quot;</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;G&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;*&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Unrecognized internal world W encoding.&quot;</span><span class="p">)</span>
            <span class="n">out_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">out_str</span>

    <span class="k">def</span> <span class="nf">dump_subworld</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">size</span><span class="p">:</span>
                <span class="n">IJ</span><span class="p">,</span>
            <span class="n">offset</span><span class="p">:</span>
                <span class="n">IJ</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">prefix</span><span class="p">:</span>
                <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
            <span class="n">extend</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate new GridWorld instance from part of current one.</span>

<span class="sd">        Does not perform automatic truncation (to make desired</span>
<span class="sd">        subworld fit); instead a ValueError exception is raised.</span>
<span class="sd">        However, the &quot;extend&quot; argument can be used to achieve</span>
<span class="sd">        something similar.</span>

<span class="sd">        Possible initial positions and goals are not included in the</span>
<span class="sd">        returned GridWorld instance.</span>

<span class="sd">        @param size:</span>
<span class="sd">            (height, width)</span>
<span class="sd">        @param prefix:</span>
<span class="sd">            String to be used as prefix for naming</span>
<span class="sd">            subgridworld cell variables.</span>
<span class="sd">        @param extend:</span>
<span class="sd">            If True, then any size and offset is permitted,</span>
<span class="sd">            where any positions outside the actual gridworld are</span>
<span class="sd">            assumed to be occupied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Gridworld does not exist.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;malformed size or offset.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">extend</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;offset is out of bounds.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span>
                    <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>
                    <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;unworkable subworld size, given offset.&quot;</span><span class="p">)</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
            <span class="n">sub</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]:(</span>
                <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:(</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
            <span class="n">sub</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">self_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">self_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">self_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
                           <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">self_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">sub_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">sub_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">sub_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sub</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
                          <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">sub_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sub</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">actual_size</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">self_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sub_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">self_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">sub</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sub_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">sub</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">sub_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]:(</span><span class="n">sub_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                  <span class="n">sub_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:(</span><span class="n">sub_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span>
                <span class="n">self_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]:(</span><span class="n">self_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">self_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]:(</span><span class="n">self_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">return</span> <span class="n">sub</span>

    <span class="k">def</span> <span class="nf">dump_ppartition</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">side_lengths</span><span class="p">:</span>
                <span class="n">XY</span><span class="o">=</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
            <span class="n">offset</span><span class="p">:</span>
                <span class="n">XY</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
            <span class="n">nonbool</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_abs</span><span class="o">.</span><span class="n">PropPreservingPartition</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return proposition-preserving partition from this gridworld.</span>

<span class="sd">        Adjacency of cells is as returned by prop2partition.prop2part().</span>

<span class="sd">        @param side_lengths:</span>
<span class="sd">            pair (W, H) giving width and height of</span>
<span class="sd">            each cell, assumed to be the same across the grid.</span>
<span class="sd">        @param offset:</span>
<span class="sd">            2-dimensional coordinate declaring where the</span>
<span class="sd">            bottom-left corner of the gridworld should be placed</span>
<span class="sd">            in the continuous space; default places it at the origin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">polytope</span> <span class="kn">import</span> <span class="n">Polytope</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s1">&#39;GridWorld.dump_ppartition() requires &#39;</span>
                <span class="s1">&#39;the Python package polytope.&#39;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">tulip.abstract</span> <span class="kn">import</span> <span class="n">prop2partition</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s1">&#39;`GridWorld.dump_ppartition()` requires &#39;</span>
                <span class="s1">&#39;the module `tulip.abstract`.&#39;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">error</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld does not exist.&quot;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="o">-</span> <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="o">-</span> <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
                    <span class="n">cell_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cell_var</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="c1"># adjacency[i]</span>
                <span class="n">cells</span><span class="p">[</span><span class="n">cell_var</span><span class="p">]</span> <span class="o">=</span> <span class="n">Polytope</span><span class="p">(</span>
                        <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                             <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">),</span>
                        <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                            <span class="p">[</span><span class="o">-</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                             <span class="o">-</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                             <span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">side_lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">prop2partition</span><span class="o">.</span><span class="n">prop2part</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">spec</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">offset</span><span class="p">:</span>
                <span class="n">IJ</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">controlled_dyn</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">nonbool</span><span class="p">:</span>
                <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_form</span><span class="o">.</span><span class="n">GRSpec</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return GRSpec instance describing this gridworld.</span>

<span class="sd">        The offset argument is motivated by the use-case of multiple</span>
<span class="sd">        agents whose moves are governed by separate &quot;gridworlds&quot; but</span>
<span class="sd">        who interact in a shared space; with an offset, we can make</span>
<span class="sd">        &quot;sub-gridworlds&quot; and enforce rules like mutual exclusion.</span>

<span class="sd">        If nonbool is False, then variables are named according to</span>
<span class="sd">        prefix_R_C, where prefix is given (attribute of this GridWorld</span>
<span class="sd">        object), R is the row, and C is the column of the cell</span>
<span class="sd">        (0-indexed).  If nonbool is True (default), cells are</span>
<span class="sd">        identified with subformulae of the form:</span>

<span class="sd">          ((prefix_r = R) &amp; (prefix_c = C))</span>

<span class="sd">        `GridWorld.__getitem__` and `extract_coord` provide</span>
<span class="sd">        reference implementations.</span>

<span class="sd">        @param offset:</span>
<span class="sd">            index offset to apply when generating the</span>
<span class="sd">            specification; e.g., given prefix of &quot;Y&quot;,</span>
<span class="sd">            offset=(2,1) would cause the variable for the cell at</span>
<span class="sd">            (0,3) to be named Y_2_4.</span>
<span class="sd">        @param controlled_dyn:</span>
<span class="sd">            whether to treat this gridworld as</span>
<span class="sd">            describing controlled (&quot;system&quot;) or uncontrolled</span>
<span class="sd">            (&quot;environment&quot;) variables.</span>
<span class="sd">        @param nonbool:</span>
<span class="sd">            If True, then use variables with integer domains.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Gridworld does not exist.&quot;</span><span class="p">)</span>
        <span class="n">row_low</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">row_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">col_low</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">col_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">spec_trans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">orig_offset</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="c1"># Safety, transitions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row_low</span><span class="p">,</span> <span class="n">row_high</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_low</span><span class="p">,</span> <span class="n">col_high</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                        <span class="c1"># Cannot start from</span>
                        <span class="c1"># an occupied cell.</span>
                <span class="n">spec_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; -&gt; (&quot;</span><span class="p">)</span>
                <span class="c1"># Normal transitions:</span>
                <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
                    <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">row_low</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; || &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
                        <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">col_low</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; || &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">row_high</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; || &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
                        <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">col_high</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot; || &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                <span class="n">spec_trans</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;)&quot;</span>
        <span class="c1"># Safety, static</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row_low</span><span class="p">,</span> <span class="n">row_high</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_low</span><span class="p">,</span> <span class="n">col_high</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">spec_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;!(&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="c1"># Safety, mutex;</span>
        <span class="c1"># only needed when using</span>
        <span class="c1"># boolean variables for cells</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="n">pos_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">_itr</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">row_low</span><span class="p">,</span> <span class="n">row_high</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_low</span><span class="p">,</span> <span class="n">col_high</span><span class="p">))]</span>
            <span class="n">disj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">outer_ind</span> <span class="ow">in</span> <span class="n">pos_indices</span><span class="p">:</span>
                <span class="n">conj</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">outer_ind</span> <span class="o">!=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">outer_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">outer_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">outer_ind</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">conj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_n_n&#39;&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">conj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">outer_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outer_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">inner_ind</span> <span class="ow">in</span> <span class="n">pos_indices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span>
                            <span class="p">(</span>
                                <span class="n">inner_ind</span> <span class="o">!=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">and</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">inner_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">inner_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>
                            <span class="n">outer_ind</span> <span class="o">==</span> <span class="n">inner_ind</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">inner_ind</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">conj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(!X </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_n_n)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">conj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="s2">&quot;(!&quot;</span> <span class="o">+</span>
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                                <span class="p">(</span><span class="n">inner_ind</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inner_ind</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                <span class="n">disj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conj</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
            <span class="n">spec_trans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">|| &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">disj</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="n">sys_vars</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_r&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_c&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys_vars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">row_low</span><span class="p">,</span> <span class="n">row_high</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_low</span><span class="p">,</span> <span class="n">col_high</span><span class="p">):</span>
                    <span class="n">sys_vars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
            <span class="n">initspec</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initspec</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
                <span class="n">mutex</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">((</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)]</span>
                <span class="n">mutex</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;!</span><span class="si">{</span><span class="n">ovar</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">ovar</span> <span class="ow">in</span> <span class="n">sys_vars</span> <span class="k">if</span> <span class="n">ovar</span> <span class="o">!=</span>
                              <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)])</span>
                <span class="n">initspec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot; &amp;&amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mutex</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
        <span class="n">init_str</span> <span class="o">=</span> <span class="s2">&quot; || &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initspec</span><span class="p">)</span>
        <span class="n">spec_goal</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
            <span class="n">spec_goal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">orig_offset</span>
        <span class="k">if</span> <span class="n">controlled_dyn</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_form</span><span class="o">.</span><span class="n">GRSpec</span><span class="p">(</span>
                <span class="n">sys_vars</span><span class="o">=</span><span class="n">sys_vars</span><span class="p">,</span>
                <span class="n">sys_init</span><span class="o">=</span><span class="n">init_str</span><span class="p">,</span>
                <span class="n">sys_safety</span><span class="o">=</span><span class="n">spec_trans</span><span class="p">,</span>
                <span class="n">sys_prog</span><span class="o">=</span><span class="n">spec_goal</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_form</span><span class="o">.</span><span class="n">GRSpec</span><span class="p">(</span>
                <span class="n">env_vars</span><span class="o">=</span><span class="n">sys_vars</span><span class="p">,</span>
                <span class="n">env_init</span><span class="o">=</span><span class="n">init_str</span><span class="p">,</span>
                <span class="n">env_safety</span><span class="o">=</span><span class="n">spec_trans</span><span class="p">,</span>
                <span class="n">env_prog</span><span class="o">=</span><span class="n">spec_goal</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">xf</span><span class="p">:</span>
                <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">yf</span><span class="p">:</span>
                <span class="nb">int</span><span class="o">=</span><span class="mi">1</span>
            <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a new gridworld equivalent to this but scaled by integer</span>
<span class="sd">        factor (xf, yf). In the new world, obstacles are increased in size but</span>
<span class="sd">        initials and goals change their position only. If this world is of size</span>
<span class="sd">        (h, w) then the returned world will be of size (h*yf, w*xf).</span>

<span class="sd">        @param xf:</span>
<span class="sd">            scaling factor for columns</span>
<span class="sd">        @param yf:</span>
<span class="sd">            scaling factor for rows</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape_scaled</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">yf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">xf</span><span class="p">)</span>
        <span class="n">scaleW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape_scaled</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">scale_goal</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">scale_init</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape_scaled</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape_scaled</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">//</span> <span class="n">yf</span><span class="p">,</span> <span class="n">col</span> <span class="o">//</span> <span class="n">xf</span><span class="p">)</span>
                <span class="n">yr</span><span class="p">,</span> <span class="n">xr</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span> <span class="o">%</span> <span class="n">yf</span><span class="p">,</span> <span class="n">col</span> <span class="o">%</span> <span class="n">xf</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">scaleW</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">yr</span><span class="p">,</span> <span class="n">xr</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goal_list</span><span class="p">:</span>
                        <span class="n">scale_goal</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_list</span><span class="p">:</span>
                        <span class="n">scale_init</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="n">scale_gw</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
        <span class="n">scale_gw</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">scaleW</span>
        <span class="n">scale_gw</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="n">scale_goal</span>
        <span class="n">scale_gw</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="n">scale_init</span>
        <span class="k">return</span> <span class="n">scale_gw</span>


<span class="k">def</span> <span class="nf">random_world</span><span class="p">(</span>
        <span class="n">size</span><span class="p">,</span>
        <span class="n">wall_density</span><span class="p">:</span>
            <span class="nb">float</span><span class="o">=</span><span class="mf">.2</span><span class="p">,</span>
        <span class="n">num_init</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">num_goals</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span>
            <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span>
        <span class="n">ensure_feasible</span><span class="p">:</span>
            <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">|</span>
            <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">num_trolls</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ty</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span>
            <span class="s1">&#39;GridWorld&#39;</span><span class="p">,</span>
            <span class="nb">tuple</span><span class="p">[</span>
                <span class="s1">&#39;GridWorld&#39;</span><span class="p">,</span>
                <span class="nb">list</span><span class="p">],</span>
            <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate random gridworld of given size.</span>

<span class="sd">    While an instance of GridWorld is returned, other views of the</span>
<span class="sd">    result are possible; e.g., to obtain a description string, use</span>
<span class="sd">    `GridWorld.dumps`.</span>

<span class="sd">    @param size:</span>
<span class="sd">        a pair, indicating number of rows and columns.</span>
<span class="sd">    @param wall_density:</span>
<span class="sd">        the ratio of walls to total number of cells.</span>
<span class="sd">    @param num_init:</span>
<span class="sd">        number of possible initial positions.</span>
<span class="sd">    @param num_goals:</span>
<span class="sd">        number of positions to be visited infinitely often.</span>
<span class="sd">    @param prefix:</span>
<span class="sd">        string to be used as prefix for naming gridworld</span>
<span class="sd">        cell variables.</span>
<span class="sd">    @param num_trolls:</span>
<span class="sd">        number of random trolls to generate, each</span>
<span class="sd">        occupies an area of radius 1.  If nonzero, then a list</span>
<span class="sd">        specifying the trolls will also be returned.</span>
<span class="sd">    @param ensure_feasible:</span>
<span class="sd">        guarantee that all goals and initial</span>
<span class="sd">        positions are mutually reachable, assuming a 4-connected</span>
<span class="sd">        grid. This method may not be complete, i.e., may fail to</span>
<span class="sd">        return a feasible random gridworld with the given</span>
<span class="sd">        parameters.  Note that &quot;feasibility&quot; does not account for</span>
<span class="sd">        nondeterminism (in particular, nonzero num_trolls</span>
<span class="sd">        argument has no effect.)</span>
<span class="sd">    @param timeout:</span>
<span class="sd">        if ensure_feasible, then quit if no correct random</span>
<span class="sd">        world is found before timeout seconds.  If timeout is</span>
<span class="sd">        None (default), then do not impose time constraints.</span>
<span class="sd">    @return:</span>
<span class="sd">        is `None` if timeout occurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ensure_feasible</span> <span class="ow">and</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">num_cells</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">goal_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">init_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">troll_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_cells</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">wall_density</span> <span class="o">*</span> <span class="n">num_cells</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_goals</span><span class="p">):</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cells</span><span class="p">))[</span><span class="n">W</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">_itr</span><span class="o">.</span><span class="n">filterfalse</span><span class="p">(</span>
            <span class="n">goal_list</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">,</span>
            <span class="n">avail_inds</span><span class="p">))</span>
        <span class="n">goal_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">avail_inds</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">avail_inds</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_init</span><span class="p">):</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cells</span><span class="p">))[</span><span class="n">W</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">filter_</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goal_list</span> <span class="ow">and</span>
                <span class="n">index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">init_list</span><span class="p">)</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span>
            <span class="n">filter_</span><span class="p">,</span> <span class="n">avail_inds</span><span class="p">))</span>
        <span class="n">init_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">avail_inds</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">avail_inds</span><span class="p">))])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trolls</span><span class="p">):</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cells</span><span class="p">))[</span><span class="n">W</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">avail_inds</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goal_list</span> <span class="ow">and</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">init_list</span> <span class="ow">and</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">)]</span>
        <span class="n">troll_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">avail_inds</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">avail_inds</span><span class="p">))])</span>
    <span class="n">bcounter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">bcounter</span> <span class="o">&lt;</span> <span class="n">num_blocks</span><span class="p">:</span>
        <span class="c1"># Add blocks (or &quot;wall cells&quot;)</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">num_cells</span><span class="p">))[</span><span class="n">W</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">avail_inds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">avail_inds</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">goal_list</span> <span class="ow">and</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">init_list</span> <span class="ow">and</span>
                <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">)]</span>
        <span class="n">changed_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">avail_inds</span><span class="p">))</span>
        <span class="n">W</span><span class="p">[</span><span class="n">avail_inds</span><span class="p">[</span><span class="n">changed_index</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">bcounter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">ensure_feasible</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="c1"># If feasibility must be guaranteed,</span>
            <span class="c1"># then check whether</span>
            <span class="c1"># the newly unreachable cell</span>
            <span class="c1"># is permissible.</span>
            <span class="n">W_tmp</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">goal_list_tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">goal_list</span><span class="p">]</span>
            <span class="n">init_list_tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">init_list</span><span class="p">]</span>
            <span class="n">troll_list_tmp</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">]</span>
            <span class="n">world</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
            <span class="n">world</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W_tmp</span>
            <span class="n">chain_of_points</span> <span class="o">=</span> <span class="n">init_list_tmp</span><span class="p">[:]</span>
            <span class="n">chain_of_points</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">goal_list_tmp</span><span class="p">)</span>
            <span class="n">is_feasible</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chain_of_points</span><span class="p">)):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">world</span><span class="o">.</span><span class="n">is_reachable</span><span class="p">(</span>
                        <span class="n">chain_of_points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">chain_of_points</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">chain_of_points</span><span class="p">)]):</span>
                    <span class="n">is_feasible</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_feasible</span><span class="p">:</span>
                <span class="n">W</span><span class="p">[</span><span class="n">avail_inds</span><span class="p">[</span><span class="n">changed_index</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">bcounter</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="c1"># Reshape the gridworld to final form;</span>
    <span class="c1"># build and return the result.</span>
    <span class="n">W</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">goal_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">goal_list</span><span class="p">]</span>
    <span class="n">init_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">init_list</span><span class="p">]</span>
    <span class="n">troll_list</span> <span class="o">=</span> <span class="p">[((</span><span class="n">k</span> <span class="o">//</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span> <span class="o">%</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">]</span>
    <span class="n">world</span> <span class="o">=</span> <span class="n">GridWorld</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">)</span>
    <span class="n">world</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">W</span>
    <span class="n">world</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="n">goal_list</span>
    <span class="n">world</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="n">init_list</span>
    <span class="k">if</span> <span class="n">num_trolls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">world</span><span class="p">,</span> <span class="n">troll_list</span>
    <span class="k">return</span> <span class="n">world</span>


<span class="k">def</span> <span class="nf">narrow_passage</span><span class="p">(</span>
        <span class="n">size</span><span class="p">,</span>
        <span class="n">passage_width</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">num_init</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">num_goals</span><span class="p">:</span>
            <span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">passage_length</span><span class="p">:</span>
            <span class="nb">float</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">ptop</span><span class="p">:</span>
            <span class="nb">int</span> <span class="o">|</span>
            <span class="kc">None</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span>
            <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;GridWorld&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a narrow-passage world: this is a world containing</span>
<span class="sd">    two zones (initial, final) with a tube connecting them.</span>

<span class="sd">    @param size:</span>
<span class="sd">        a pair, indicating number of rows and columns.</span>
<span class="sd">    @param passage_width:</span>
<span class="sd">        the width of the connecting passage in cells.</span>
<span class="sd">    @param passage_length:</span>
<span class="sd">        the length of the passage as a proportion of the</span>
<span class="sd">        width of the world.</span>
<span class="sd">    @param num_init:</span>
<span class="sd">        number of possible initial positions.</span>
<span class="sd">    @param num_goals:</span>
<span class="sd">        number of positions to be visited infinitely often.</span>
<span class="sd">    @param ptop:</span>
<span class="sd">        row number of top of passage, default (None) is random</span>
<span class="sd">    @param prefix:</span>
<span class="sd">        string to be used as prefix for naming gridworld</span>
<span class="sd">        cell variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">size</span>
    <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Gridworld too small: &quot;</span>
            <span class="s2">&quot;minimum dimension 3&quot;</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">unoccupied</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    <span class="c1"># Zone width is 30% of</span>
    <span class="c1"># world width by default</span>
    <span class="n">zone_width</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">passage_length</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">izone</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zone_width</span><span class="p">))</span>
        <span class="c1"># boundary of left zone</span>
    <span class="n">gzone</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zone_width</span><span class="p">))</span>
        <span class="c1"># boundary of right zone</span>
    <span class="n">too_many_init_or_goals</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">izone</span> <span class="o">*</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">num_init</span> <span class="ow">or</span>
        <span class="n">gzone</span> <span class="o">*</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">num_goals</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">too_many_init_or_goals</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Too many initials/goals for grid size&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ptop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ptop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">passage_width</span><span class="p">)</span>
    <span class="n">passage</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">ptop</span><span class="p">,</span> <span class="n">ptop</span> <span class="o">+</span> <span class="n">passage_width</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">passage</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">izone</span><span class="p">,</span> <span class="n">gzone</span><span class="p">):</span>
            <span class="n">Z</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">y</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">avail_cells</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">izone</span><span class="p">)]</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">avail_cells</span><span class="p">,</span> <span class="n">num_init</span><span class="p">)</span>
    <span class="n">avail_cells</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gzone</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">avail_cells</span><span class="p">,</span> <span class="n">num_goals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Z</span>


<span class="k">def</span> <span class="nf">unoccupied</span><span class="p">(</span>
        <span class="n">size</span><span class="p">:</span>
            <span class="n">IJ</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span>
            <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GridWorld</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate entirely unoccupied gridworld of given size.</span>

<span class="sd">    @param size:</span>
<span class="sd">        number of rows and columns.</span>
<span class="sd">    @param prefix:</span>
<span class="sd">        prefix for naming gridworld</span>
<span class="sd">        cell variables.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;invalid gridworld size.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GridWorld</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_trolls</span><span class="p">(</span>
        <span class="n">Y</span><span class="p">:</span>
            <span class="n">GridWorld</span><span class="p">,</span>
        <span class="n">troll_list</span><span class="p">:</span>
            <span class="nb">list</span><span class="p">,</span>
        <span class="n">prefix</span><span class="p">:</span>
            <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
        <span class="n">start_anywhere</span><span class="p">:</span>
            <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">nonbool</span><span class="p">:</span>
            <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">get_moves_lists</span><span class="p">:</span>
            <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
            <span class="n">_form</span><span class="o">.</span><span class="n">GRSpec</span> <span class="o">|</span>
            <span class="nb">tuple</span><span class="p">[</span><span class="n">_form</span><span class="o">.</span><span class="n">GRSpec</span><span class="p">,</span> <span class="nb">list</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create GR(1) specification with troll-like obstacles.</span>

<span class="sd">    Trolls are introduced into the specification with names derived</span>
<span class="sd">    from the given prefix and a number (matching the order in</span>
<span class="sd">    troll_list).  Note that mutual exclusion is only between the</span>
<span class="sd">    controlled &quot;Y gridworld&quot; position and each troll, but not</span>
<span class="sd">    between trolls.</span>

<span class="sd">    @param Y:</span>
<span class="sd">        The controlled gridworld, describing in particular</span>
<span class="sd">        static obstacles that must be respected by the trolls.</span>
<span class="sd">    @param troll_list:</span>
<span class="sd">        List of pairs of center position, to which the</span>
<span class="sd">        troll must always eventually return, and radius defining</span>
<span class="sd">        the extent of the trollspace.  The radius is measured</span>
<span class="sd">        using infinity-norm.</span>
<span class="sd">    @param start_anywhere:</span>
<span class="sd">        If True, then initial troll position can be</span>
<span class="sd">        anywhere in its trollspace.  Else (default), the troll is</span>
<span class="sd">        assumed to begin each game at its center position.</span>
<span class="sd">    @param nonbool:</span>
<span class="sd">        If True, then use variables with integer domains.</span>
<span class="sd">    @param get_moves_lists:</span>
<span class="sd">        Consult returned value description below.</span>
<span class="sd">    @return:</span>
<span class="sd">        If get_moves_lists is True, then returns (spec, moves_N)</span>
<span class="sd">        where spec is the specification incorporating all of the</span>
<span class="sd">        trolls, and moves_N is a list of lists of states (where</span>
<span class="sd">        &quot;state&quot; is given as a dictionary with keys of variable</span>
<span class="sd">        names), where the length of moves_N is equal to the</span>
<span class="sd">        number of trolls, and each element of moves_N is a list</span>
<span class="sd">        of possible states of that the corresponding troll</span>
<span class="sd">        (dynamic obstacle).  If get_moves_lists is False, then</span>
<span class="sd">        moves_N is not returned and not computed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">X_ID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">get_moves_lists</span><span class="p">:</span>
        <span class="n">moves_N</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">center</span><span class="p">,</span> <span class="n">radius</span> <span class="ow">in</span> <span class="n">troll_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">num_rows</span> <span class="ow">or</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">num_cols</span> <span class="ow">or</span>
                <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;troll center is outside of gridworld&quot;</span><span class="p">)</span>
        <span class="n">t_offset</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">radius</span><span class="p">))</span>
        <span class="n">t_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span>
                  <span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">num_rows</span><span class="p">:</span>
            <span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">num_cols</span><span class="p">:</span>
            <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_cols</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">t_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">X_ID</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">t_offset</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">dump_subworld</span><span class="p">(</span>
            <span class="n">t_size</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">t_offset</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">X_ID</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)))</span>
        <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">goal_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">start_anywhere</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_empty</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)):</span>
                        <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">init_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">init_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                   <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">if</span> <span class="n">get_moves_lists</span><span class="p">:</span>
            <span class="n">moves_N</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">moves_N</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">state</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span>
                        <span class="n">offset</span><span class="o">=</span><span class="n">t_offset</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">))</span>
    <span class="n">spec</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">spec</span><span class="p">(</span><span class="n">controlled_dyn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Xi</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">spec</span> <span class="o">|=</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spec</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                           <span class="n">controlled_dyn</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">)</span>
    <span class="c1"># Mutual exclusion</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">Xi</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                        <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="n">i</span> <span class="o">&lt;</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span>
                        <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">nonbool</span><span class="p">:</span>
                        <span class="n">Xivar</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;((X </span><span class="si">{</span><span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;_r = </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;) &amp; (X </span><span class="si">{</span><span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">_c = &#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Xi</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">))&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Xivar</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="sa">f</span><span class="s1">&#39;X </span><span class="si">{</span><span class="n">Xi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">prefix</span><span class="si">}</span><span class="s1">&#39;</span>
                            <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">spec</span><span class="o">.</span><span class="n">sys_safety</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;!(&quot;</span> <span class="o">+</span> <span class="n">Y</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">nonbool</span><span class="o">=</span><span class="n">nonbool</span><span class="p">,</span> <span class="n">use_next</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">+</span>
                        <span class="sa">f</span><span class="s2">&quot; &amp;&amp; </span><span class="si">{</span><span class="n">Xivar</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">get_moves_lists</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">moves_N</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spec</span>


<span class="k">def</span> <span class="nf">extract_coord</span><span class="p">(</span>
        <span class="n">var_name</span><span class="p">:</span>
            <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="o">|</span>
            <span class="nb">tuple</span><span class="p">[</span>
                <span class="nb">str</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assuming prefix_R_C format, return `(prefix, row, column)`.</span>

<span class="sd">    The &quot;nowhere&quot; coordinate has form prefix_n_n. To indicate this,</span>
<span class="sd">    (-1, -1) is returned as the row, column position.</span>

<span class="sd">    If error, return None or throw exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;extract_coord: invalid argument type; &quot;</span>
            <span class="s2">&quot;must be string.&quot;</span><span class="p">)</span>
    <span class="n">name_frags</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_frags</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name_frags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span> <span class="ow">and</span> <span class="n">name_frags</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span>
            <span class="c1"># Special &quot;nowhere&quot; case</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_frags</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name_frags</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">name_frags</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">name_frags</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">animate_paths</span><span class="p">(</span>
        <span class="n">Z</span><span class="p">:</span>
            <span class="n">GridWorld</span><span class="p">,</span>
        <span class="n">paths</span><span class="p">:</span>
            <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span>
        <span class="n">jitter</span><span class="p">:</span>
            <span class="nb">float</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">save_prefix</span><span class="p">:</span>
            <span class="nb">str</span> <span class="o">|</span>
            <span class="kc">None</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="o">|</span>
            <span class="n">FuncAnimation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Animate a list of paths simultaneously in world Z.</span>

<span class="sd">    The animation is with `matplotlib`.</span>

<span class="sd">    @param Z:</span>
<span class="sd">        Gridworld for which paths were generated.</span>
<span class="sd">    @param paths:</span>
<span class="sd">        List of paths to animate (one per robot). Each path</span>
<span class="sd">        is a list of pairs of gridworld cells, i.e., of the form</span>
<span class="sd">        [(r0, c0), (r1, c1), ...], where the first position is</span>
<span class="sd">        row r0 and column c0, etc.</span>
<span class="sd">    @param jitter:</span>
<span class="sd">        Random jitter added to each coordinate value in</span>
<span class="sd">        animation.  Makes the robot&#39;s path more visible by</span>
<span class="sd">        avoiding overlap.</span>
<span class="sd">    @param save_prefix:</span>
<span class="sd">        If not None, do not show an animation but</span>
<span class="sd">        produce a series of images &quot;&lt;save_prefix&gt;nnn.png&quot; which</span>
<span class="sd">        can be compiled into an animated GIF.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">_mpl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;matplotlib not available, &#39;</span>
              <span class="s1">&#39;so skipping gridworld.animate_paths()&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">last</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">numberic_str_width</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">last</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="s1">&#39;rgbcmyk&#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
        <span class="n">Z</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">font_pt</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">288</span> <span class="o">//</span> <span class="n">Z</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">48</span><span class="p">),</span>
            <span class="n">show_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">update_line</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">dlist</span><span class="p">,</span> <span class="n">lines</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">dlist</span><span class="p">):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="n">num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">p</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">num</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">save_prefix</span><span class="p">:</span>
            <span class="n">num_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span>
                <span class="n">numberic_str_width</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_prefix</span><span class="si">}{</span><span class="n">num_str</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">paths</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">jitter</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="o">*</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="n">l</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[],</span> <span class="p">[],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">l_trail</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[],</span> <span class="p">[],</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">l_trail</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">save_prefix</span><span class="p">:</span>
        <span class="n">anim</span> <span class="o">=</span> <span class="n">FuncAnimation</span><span class="p">(</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">update_line</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">,</span>
            <span class="n">fargs</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lines</span><span class="p">),</span>
            <span class="n">interval</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">anim</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">*</span> <span class="n">numberic_str_width</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;Writing </span><span class="si">{</span><span class="n">save_prefix</span><span class="si">}{</span><span class="n">zeros</span><span class="si">}</span><span class="s1">.png - &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">save_prefix</span><span class="si">}{</span><span class="n">last</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">update_line</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">lines</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
<div id="sidebarbutton" title="Collapse sidebar">
<span>«</span>
</div>

      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../../index.html">TuLiP 1.4.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">tulip.gridworld</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2010-2017, California Institute of Technology.
      Last updated on 17 April 2024.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.1.
    </div>
  </body>
</html>